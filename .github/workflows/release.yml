name: Release ZCore

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'

    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v4
      with:
        cache-read-only: false
    
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    
    - name: Build with Gradle
      run: ./gradlew clean shadowJar --no-daemon --stacktrace
    
    - name: Get version from tag
      id: get_version
      run: |
        VERSION=${GITHUB_REF#refs/tags/v}
        echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT
        echo "TAG=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
    
    - name: Get JAR filename
      id: get_jar
      run: |
        JAR_FILE=$(ls build/libs/*.jar | head -1)
        echo "JAR_FILE=${JAR_FILE}" >> $GITHUB_OUTPUT
        echo "JAR_NAME=$(basename ${JAR_FILE})" >> $GITHUB_OUTPUT
    
    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: ${{ steps.get_jar.outputs.JAR_FILE }}
        tag_name: ${{ steps.get_version.outputs.TAG }}
        name: ZCore v${{ steps.get_version.outputs.VERSION }}
        body: |
          ## ğŸ¯ ZCore v${{ steps.get_version.outputs.VERSION }}
          
          **Minecraft Compatibility:** 1.8 - 1.21+  
          **Java Version:** 8+
          
          ### ğŸ“¦ What's Included
          
          ZCore is a utility library plugin providing shared dependencies and helper classes for Minecraft plugins.
          
          **Bundled Libraries:**
          - âœ¨ Adventure API 4.17.0 (text components)
          - ğŸ“ Adventure MiniMessage 4.17.0 (modern formatting)
          - ğŸ”„ Adventure Legacy Serializer 4.17.0 (legacy color codes)
          - ğŸ® Adventure Platform Bukkit 4.3.4 (MC 1.8+ support)
          - ğŸ“„ BoostedYAML 1.3.7 (config management)
          - ğŸ”§ org.json 20240303 (JSON parsing)
          
          **Utility Classes:**
          - `ColorUtil` - Smart text colorization with hex support
          - `MessageManager` - Multi-language message system
          - `ConfigManager` - Enhanced config handling
          
          ---
          
          ### ğŸ“¥ Installation (Server Owners)
          
          1. Download `${{ steps.get_jar.outputs.JAR_NAME }}`
          2. Place in your `plugins/` folder
          3. Restart the server
          
          **Note:** This is a library plugin - it provides functionality for other plugins!
          
          ---
          
          ### ğŸ‘¨â€ğŸ’» For Developers
          
          Add ZCore as a dependency using JitPack:
          
          ```gradle
          repositories {
              maven { url = 'https://jitpack.io' }
          }
          
          dependencies {
              compileOnly 'com.github.THEzombiePL:ZCore:${{ steps.get_version.outputs.TAG }}'
          }
          ```
          
          **plugin.yml:**
          ```yaml
          depend: [ZCore]
          ```
          
          **Usage Example:**
          ```java
          import me.thezombiepl.plugin.zcore.utils.ColorUtil;
          import net.kyori.adventure.text.Component;
          
          Component message = ColorUtil.colorize("<gradient:red:blue>Rainbow text!");
          player.sendMessage(message);
          ```
          
          ---
          
          ### ğŸ“š Documentation
          
          - [GitHub Repository](https://github.com/THEzombiePL/ZCore)
          - [Example Plugins](https://github.com/THEzombiePL/ZGuard)
          
          ### ğŸ› Report Issues
          
          Found a bug? [Open an issue](https://github.com/THEzombiePL/ZCore/issues)
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}